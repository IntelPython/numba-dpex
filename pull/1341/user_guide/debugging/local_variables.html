<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LGGL0NJK6P"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-LGGL0NJK6P');
    </script>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Debugging Features in Numba 0.55" href="numba-0.55.html" /><link rel="prev" title="Altering Execution" href="altering.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Debugging Local Variables - numba-dpex documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">numba-dpex  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">numba-dpex  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programming_model.html">Programming Model</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../kernel_programming/index.html">Kernel Programming Basics</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Kernel Programming Basics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../kernel_programming/writing_kernels.html">Writing Data Parallel Kernels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel_programming/synchronization.html">Synchronization Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel_programming/device-functions.html">Writing Device Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel_programming/atomic-operations.html">Supported Atomic Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel_programming/memory_allocation_address_space.html">Supported Address Space Qualifiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel_programming/reduction.html">Reduction on SYCL-supported Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel_programming/ufunc.html">Universal Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kernel_programming/supported-python-features.html">Supported Python Features inside <code class="docutils literal notranslate"><span class="pre">numba_dpex.kernel</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dpnp_offload.html">Compiling and Offloading <code class="docutils literal notranslate"><span class="pre">dpnp</span></code> statements</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Debugging with Intel® Distribution for GDB*</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Debugging with Intel® Distribution for GDB*</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="set_up_machine.html">Set up the machine for debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging_environment.html">Configure debugging environment</a></li>
<li class="toctree-l3 current has-children"><a class="reference internal" href="features.html">Supported Features</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Supported Features</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="breakpoints.html">Breakpoints</a></li>
<li class="toctree-l4"><a class="reference internal" href="stepping.html">Stepping</a></li>
<li class="toctree-l4"><a class="reference internal" href="frame_info.html">Information About a Frame</a></li>
<li class="toctree-l4"><a class="reference internal" href="backtrace.html">Backtrace</a></li>
<li class="toctree-l4"><a class="reference internal" href="data.html">Examining Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="symbols.html">Examining the Symbol Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="altering.html">Altering Execution</a></li>
<li class="toctree-l4 current current-page"><a class="current reference internal" href="#">Debugging Local Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="numba-0.55.html">Debugging Features in Numba 0.55</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="limitations.html">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="common_issues.html">Common issues and tips</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../config.html">Configuration Options for <code class="docutils literal notranslate"><span class="pre">numba-dpex</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/index.html">numba_dpex.kernel_api</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of numba_dpex.kernel_api</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/atomic_fence/index.html">numba_dpex.kernel_api.atomic_fence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/atomic_ref/index.html">numba_dpex.kernel_api.atomic_ref</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/barrier/index.html">numba_dpex.kernel_api.barrier</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/flag_enum/index.html">numba_dpex.kernel_api.flag_enum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/index_space_ids/index.html">numba_dpex.kernel_api.index_space_ids</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/launcher/index.html">numba_dpex.kernel_api.launcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/memory_enums/index.html">numba_dpex.kernel_api.memory_enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/numba_dpex/kernel_api/ranges/index.html">numba_dpex.kernel_api.ranges</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../useful_links.html">Useful links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribution_guide.html">Contribution Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">List of examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release Notes</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="debugging-local-variables">
<h1>Debugging Local Variables<a class="headerlink" href="#debugging-local-variables" title="Link to this heading">#</a></h1>
<p>Several conditions could influence debugging of local variables:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#numba-opt"><span class="std std-ref">Optimization Level for LLVM</span></a></p></li>
<li><p><a class="reference internal" href="#local-variables-lifetime"><span class="std std-ref">Local Variables Lifetime in Numba IR</span></a></p></li>
</ol>
<section id="optimization-level-for-llvm">
<span id="numba-opt"></span><h2>Optimization Level for LLVM<a class="headerlink" href="#optimization-level-for-llvm" title="Link to this heading">#</a></h2>
<p>Numba provides environment variable <code class="docutils literal notranslate"><span class="pre">NUMBA_OPT</span></code> for configuring
optimization level for LLVM. The default optimization level is three.
Refer <a class="reference external" href="https://numba.readthedocs.io/en/stable/reference/envvars.html?#envvar-NUMBA_OPT">Numba documentation</a> for details. It is recommended to debug with
<code class="samp docutils literal notranslate"><span class="pre">NUMBA_OPT=0</span></code>. The possible effect of various optimization levels may be
as follows:</p>
<ul class="simple">
<li><p><code class="samp docutils literal notranslate"><span class="pre">NUMBA_OPT=0</span></code> means “no optimization” level - all local variables are available.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">NUMBA_OPT=1</span></code> or higher levels - some variables may be optimized out.</p></li>
</ul>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h3>
<p>Source code <code class="file docutils literal notranslate"><span class="pre">numba_dpex/examples/debug/sum_local_vars.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">11</span><span class="nd">@ndpx</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">12</span><span class="k">def</span> <span class="nf">data_parallel_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="linenos">13</span>    <span class="n">i</span> <span class="o">=</span> <span class="n">ndpx</span><span class="o">.</span><span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">14</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.5</span>
<span class="linenos">15</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.3</span>
<span class="hll"><span class="linenos">16</span>    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
</span></pre></div>
</div>
<p>Debug session with <code class="samp docutils literal notranslate"><span class="pre">NUMBA_OPT=0</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>gdb-oneapi<span class="w"> </span>-q<span class="w"> </span>python
<span class="go">...</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">set environment NUMBA_OPT 0</span>
</span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">break sum_local_vars.py:26</span>
<span class="go">...</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">run numba_dpex/examples/debug/sum_local_vars.py</span>
<span class="go">...</span>
<span class="go">Thread 2.1 hit Breakpoint 1, with SIMD lanes [0-7], __main__::data_parallel_sum (a=..., b=..., c=...) at sum_local_vars.py:26</span>
<span class="go">26          c[i] = l1 + l2</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">info locals</span>
</span><span class="hll"><span class="go">i = 0</span>
</span><span class="hll"><span class="go">l1 = 2.9795852899551392</span>
</span><span class="hll"><span class="go">l2 = 0.22986688613891601</span>
</span></pre></div>
</div>
<p>It printed all local variables with their values.</p>
<p>Debug session with <code class="samp docutils literal notranslate"><span class="pre">NUMBA_OPT=1</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>gdb-oneapi<span class="w"> </span>-q<span class="w"> </span>python
<span class="go">...</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">set environment NUMBA_OPT 1</span>
</span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">break sum_local_vars.py:26</span>
<span class="go">...</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">run numba_dpex/examples/debug/sum_local_vars.py</span>
<span class="go">...</span>
<span class="go">Thread 2.1 hit Breakpoint 1, with SIMD lanes [0-7], ?? () at sum_local_vars.py:26 from /tmp/kernel_11059955544143858990_e6df1e.dbgelf</span>
<span class="go">26          c[i] = l1 + l2</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">info locals</span>
</span><span class="hll"><span class="go">No locals.</span>
</span></pre></div>
</div>
<p>It optimized out local variables <code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">l1</span></code> and <code class="docutils literal notranslate"><span class="pre">l2</span></code> with this optimization level.</p>
</section>
</section>
<section id="local-variables-lifetime-in-numba-ir">
<span id="local-variables-lifetime"></span><h2>Local Variables Lifetime in Numba IR<a class="headerlink" href="#local-variables-lifetime-in-numba-ir" title="Link to this heading">#</a></h2>
<p>Lifetime of Python variables are different from lifetime of variables in compiled code.
Numba analyses variables lifetime and try to optimize it.
The debugger can show the variable values, but they may be zeros
after the variable is explicitly deleted when the scope of variable is ended.</p>
<p>See <a class="reference external" href="https://numba.pydata.org/numba-doc/latest/developer/live_variable_analysis.html?highlight=delete#live-variable-analysis">Numba variable policy</a>.</p>
<p>Numba provides environment variable <code class="docutils literal notranslate"><span class="pre">NUMBA_EXTEND_VARIABLE_LIFETIMES</span></code>
for extending the lifetime of variables to the end of the block in which their lifetime ends.</p>
<p>See <a class="reference external" href="https://numba.readthedocs.io/en/stable/reference/envvars.html?#envvar-NUMBA_OPT">Numba documentation</a>.</p>
<p>Default is zero.</p>
<p>It is recommended to debug with <code class="samp docutils literal notranslate"><span class="pre">NUMBA_EXTEND_VARIABLE_LIFETIMES=1</span></code>.</p>
<section id="example-1-using-numba-extend-variable-lifetimes">
<h3>Example 1 - Using <code class="docutils literal notranslate"><span class="pre">NUMBA_EXTEND_VARIABLE_LIFETIMES</span></code><a class="headerlink" href="#example-1-using-numba-extend-variable-lifetimes" title="Link to this heading">#</a></h3>
<p>Source code <code class="file docutils literal notranslate"><span class="pre">numba_dpex/tests/debugging/test_info.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">14</span><span class="k">def</span> <span class="nf">common_loop_body</span><span class="p">(</span><span class="n">param_a</span><span class="p">,</span> <span class="n">param_b</span><span class="p">):</span>
<span class="linenos">15</span>    <span class="n">param_c</span> <span class="o">=</span> <span class="n">param_a</span> <span class="o">+</span> <span class="mi">10</span>  <span class="c1"># Set breakpoint here</span>
<span class="linenos">16</span>    <span class="n">param_d</span> <span class="o">=</span> <span class="n">param_b</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="linenos">17</span>    <span class="n">result</span> <span class="o">=</span> <span class="n">param_c</span> <span class="o">+</span> <span class="n">param_d</span>
<span class="hll"><span class="linenos">18</span>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>
</div>
<p>Debug session with <code class="samp docutils literal notranslate"><span class="pre">NUMBA_EXTEND_VARIABLE_LIFETIMES=1</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>gdb-oneapi<span class="w"> </span>-q<span class="w"> </span>python
<span class="go">...</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">set environment NUMBA_EXTEND_VARIABLE_LIFETIMES 1</span>
</span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">break side-by-side.py:28</span>
<span class="go">...</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">run numba_dpex/examples/debug/side-by-side.py --api=numba-dpex-kernel</span>
<span class="go">...</span>
<span class="go">Thread 2.1 hit Breakpoint 1, with SIMD lanes [0-7], __main__::common_loop_body (param_a=0, param_b=0) at side-by-side.py:28</span>
<span class="go">28          return result</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">info locals</span>
</span><span class="hll"><span class="go">param_c = 10</span>
</span><span class="hll"><span class="go">param_d = 0</span>
</span><span class="go">result = 10</span>
</pre></div>
</div>
<p>It prints values of <code class="docutils literal notranslate"><span class="pre">param_c</span></code> and <code class="docutils literal notranslate"><span class="pre">param_d</span></code>.</p>
<p>Debug session with <code class="samp docutils literal notranslate"><span class="pre">NUMBA_EXTEND_VARIABLE_LIFETIMES=0</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>gdb-oneapi<span class="w"> </span>-q<span class="w"> </span>python
<span class="go">...</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">set environment NUMBA_EXTEND_VARIABLE_LIFETIMES 0</span>
</span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">break side-by-side.py:28</span>
<span class="go">...</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">run numba_dpex/examples/debug/side-by-side.py --api=numba-dpex-kernel</span>
<span class="go">...</span>
<span class="go">Thread 2.1 hit Breakpoint 1, with SIMD lanes [0-7], __main__::common_loop_body (param_a=0, param_b=0) at side-by-side.py:28</span>
<span class="go">28          return result</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">info locals</span>
</span><span class="hll"><span class="go">param_c = 0</span>
</span><span class="hll"><span class="go">param_d = 0</span>
</span><span class="go">result = 10</span>
</pre></div>
</div>
</section>
<section id="example-2-using-numba-dump-annotation">
<span id="example-numba-dump-annotation"></span><h3>Example 2 - Using <code class="docutils literal notranslate"><span class="pre">NUMBA_DUMP_ANNOTATION</span></code><a class="headerlink" href="#example-2-using-numba-dump-annotation" title="Link to this heading">#</a></h3>
<p>Source code <code class="file docutils literal notranslate"><span class="pre">numba_dpex/examples/debug/sum_local_vars.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">11</span><span class="nd">@ndpx</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">12</span><span class="k">def</span> <span class="nf">data_parallel_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="linenos">13</span>    <span class="n">i</span> <span class="o">=</span> <span class="n">ndpx</span><span class="o">.</span><span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">14</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.5</span>
<span class="linenos">15</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.3</span>
<span class="linenos">16</span>    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
</pre></div>
</div>
<p>Run this code with environment variable <code class="samp docutils literal notranslate"><span class="pre">NUMBA_DUMP_ANNOTATION=1</span></code> and it
will show where numba inserts <cite>del</cite> for variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="o">-----------------------------------</span><span class="n">ANNOTATION</span><span class="o">-----------------------------------</span>
<span class="linenos"> 2</span><span class="c1"># File: numba_dpex/examples/debug/sum_local_vars.py</span>
<span class="linenos"> 3</span><span class="c1"># --- LINE 20 ---</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nd">@numba_dpex</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># --- LINE 21 ---</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">def</span> <span class="nf">data_parallel_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="c1"># --- LINE 22 ---</span>
<span class="linenos">12</span>    <span class="c1"># label 0</span>
<span class="linenos">13</span>    <span class="c1">#   a = arg(0, name=a)  :: array(float32, 1d, C)</span>
<span class="linenos">14</span>    <span class="c1">#   b = arg(1, name=b)  :: array(float32, 1d, C)</span>
<span class="linenos">15</span>    <span class="c1">#   c = arg(2, name=c)  :: array(float32, 1d, C)</span>
<span class="linenos">16</span>    <span class="c1">#   $2load_global.0 = global(dpex: &lt;module &#39;numba_dpex&#39; from &#39;.../numba-dpex/numba_dpex/__init__.py&#39;&gt;)  :: Module(&lt;module &#39;numba_dpex&#39; from &#39;.../numba-dpex/numba_dpex/__init__.py&#39;&gt;)</span>
<span class="linenos">17</span>    <span class="c1">#   $4load_method.1 = getattr(value=$2load_global.0, attr=get_global_id)  :: Function(&lt;function get_global_id at 0x7f82b8bae430&gt;)</span>
<span class="linenos">18</span>    <span class="c1">#   del $2load_global.0</span>
<span class="linenos">19</span>    <span class="c1">#   $const6.2 = const(int, 0)  :: Literal[int](0)</span>
<span class="linenos">20</span>    <span class="c1">#   i = call $4load_method.1($const6.2, func=$4load_method.1, args=[Var($const6.2, sum_local_vars.py:22)], kws=(), vararg=None, target=None)  :: (uint32,) -&gt; int64</span>
<span class="linenos">21</span>    <span class="c1">#   del $const6.2</span>
<span class="linenos">22</span>    <span class="c1">#   del $4load_method.1</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="n">i</span> <span class="o">=</span> <span class="n">dpex</span><span class="o">.</span><span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span>    <span class="c1"># --- LINE 23 ---</span>
<span class="linenos">27</span>    <span class="c1">#   $16binary_subscr.6 = getitem(value=a, index=i, fn=&lt;built-in function getitem&gt;)  :: float32</span>
<span class="hll"><span class="linenos">28</span>    <span class="c1">#   del a</span>
</span><span class="linenos">29</span>    <span class="c1">#   $const18.7 = const(float, 2.5)  :: float64</span>
<span class="linenos">30</span>    <span class="c1">#   l1 = $16binary_subscr.6 + $const18.7  :: float64</span>
<span class="linenos">31</span>    <span class="c1">#   del $const18.7</span>
<span class="linenos">32</span>    <span class="c1">#   del $16binary_subscr.6</span>
<span class="linenos">33</span>
<span class="linenos">34</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.5</span>
<span class="linenos">35</span>
<span class="linenos">36</span>    <span class="c1"># --- LINE 24 ---</span>
<span class="linenos">37</span>    <span class="c1">#   $28binary_subscr.11 = getitem(value=b, index=i, fn=&lt;built-in function getitem&gt;)  :: float32</span>
<span class="linenos">38</span>    <span class="c1">#   del b</span>
<span class="linenos">39</span>    <span class="c1">#   $const30.12 = const(float, 0.3)  :: float64</span>
<span class="linenos">40</span>    <span class="c1">#   l2 = $28binary_subscr.11 * $const30.12  :: float64</span>
<span class="linenos">41</span>    <span class="c1">#   del $const30.12</span>
<span class="linenos">42</span>    <span class="c1">#   del $28binary_subscr.11</span>
<span class="linenos">43</span>
<span class="linenos">44</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.3</span>
<span class="linenos">45</span>
<span class="linenos">46</span>    <span class="c1"># --- LINE 25 ---</span>
<span class="linenos">47</span>    <span class="c1">#   $40binary_add.16 = l1 + l2  :: float64</span>
<span class="linenos">48</span>    <span class="c1">#   del l2</span>
<span class="linenos">49</span>    <span class="c1">#   del l1</span>
<span class="linenos">50</span>    <span class="c1">#   c[i] = $40binary_add.16  :: (array(float32, 1d, C), int64, float64) -&gt; none</span>
<span class="linenos">51</span>    <span class="c1">#   del i</span>
<span class="linenos">52</span>    <span class="c1">#   del c</span>
<span class="linenos">53</span>    <span class="c1">#   del $40binary_add.16</span>
<span class="linenos">54</span>    <span class="c1">#   $const48.19 = const(NoneType, None)  :: none</span>
<span class="linenos">55</span>    <span class="c1">#   $50return_value.20 = cast(value=$const48.19)  :: none</span>
<span class="linenos">56</span>    <span class="c1">#   del $const48.19</span>
<span class="linenos">57</span>    <span class="c1">#   return $50return_value.20</span>
<span class="linenos">58</span>
<span class="linenos">59</span>    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
</pre></div>
</div>
<p>I.e. in <cite>LINE 23</cite> variable <cite>a</cite> used the last time and numba inserts <cite>del a</cite> as
shown in annotated code in line 28. It means you will see value 0 for the
variable <cite>a</cite> when you set breakpoint at <cite>LINE 24</cite>.</p>
<p>As a workaround you can expand lifetime of the variable by using it (i.e.
passing to dummy function <cite>revive()</cite>) at the end of the function. So numba will
not insert <cite>del a</cite> until the end of the function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 5</span><span class="kn">import</span> <span class="nn">dpnp</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kn">import</span> <span class="nn">numba_dpex</span> <span class="k">as</span> <span class="nn">ndpx</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="nd">@ndpx</span><span class="o">.</span><span class="n">func</span>
<span class="linenos">11</span><span class="k">def</span> <span class="nf">revive</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="linenos">12</span>    <span class="k">return</span> <span class="n">x</span>
<span class="linenos">13</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="nd">@ndpx</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">16</span><span class="k">def</span> <span class="nf">data_parallel_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="linenos">17</span>    <span class="n">i</span> <span class="o">=</span> <span class="n">ndpx</span><span class="o">.</span><span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.5</span>
<span class="linenos">19</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.3</span>
<span class="linenos">20</span>    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
<span class="linenos">21</span>    <span class="n">revive</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># pass variable to dummy function</span>
<span class="linenos">22</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="n">global_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="linenos">25</span><span class="n">N</span> <span class="o">=</span> <span class="n">global_size</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="linenos">28</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="linenos">29</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="n">data_parallel_sum</span><span class="p">[</span><span class="n">ndpx</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">global_size</span><span class="p">)](</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="o">-----------------------------------</span><span class="n">ANNOTATION</span><span class="o">-----------------------------------</span>
<span class="linenos"> 2</span><span class="c1"># File: numba_dpex/examples/debug/sum_local_vars_revive.py</span>
<span class="linenos"> 3</span><span class="c1"># --- LINE 24 ---</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nd">@numba_dpex</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># --- LINE 25 ---</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">def</span> <span class="nf">data_parallel_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="c1"># --- LINE 26 ---</span>
<span class="linenos">12</span>    <span class="c1"># label 0</span>
<span class="linenos">13</span>    <span class="c1">#   a = arg(0, name=a)  :: array(float32, 1d, C)</span>
<span class="linenos">14</span>    <span class="c1">#   b = arg(1, name=b)  :: array(float32, 1d, C)</span>
<span class="linenos">15</span>    <span class="c1">#   c = arg(2, name=c)  :: array(float32, 1d, C)</span>
<span class="linenos">16</span>    <span class="c1">#   $2load_global.0 = global(dpex: &lt;module &#39;numba_dpex&#39; from &#39;.../numba-dpex/numba_dpex/__init__.py&#39;&gt;)  :: Module(&lt;module &#39;numba_dpex&#39; from &#39;.../numba-dpex/numba_dpex/__init__.py&#39;&gt;)</span>
<span class="linenos">17</span>    <span class="c1">#   $4load_method.1 = getattr(value=$2load_global.0, attr=get_global_id)  :: Function(&lt;function get_global_id at 0x7fcdf7e8c4c0&gt;)</span>
<span class="linenos">18</span>    <span class="c1">#   del $2load_global.0</span>
<span class="linenos">19</span>    <span class="c1">#   $const6.2 = const(int, 0)  :: Literal[int](0)</span>
<span class="linenos">20</span>    <span class="c1">#   i = call $4load_method.1($const6.2, func=$4load_method.1, args=[Var($const6.2, sum_local_vars_revive.py:26)], kws=(), vararg=None, target=None)  :: (uint32,) -&gt; int64</span>
<span class="linenos">21</span>    <span class="c1">#   del $const6.2</span>
<span class="linenos">22</span>    <span class="c1">#   del $4load_method.1</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="n">i</span> <span class="o">=</span> <span class="n">dpex</span><span class="o">.</span><span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span>    <span class="c1"># --- LINE 27 ---</span>
<span class="linenos">27</span>    <span class="c1">#   $16binary_subscr.6 = getitem(value=a, index=i, fn=&lt;built-in function getitem&gt;)  :: float32</span>
<span class="linenos">28</span>    <span class="c1">#   $const18.7 = const(float, 2.5)  :: float64</span>
<span class="linenos">29</span>    <span class="c1">#   l1 = $16binary_subscr.6 + $const18.7  :: float64</span>
<span class="linenos">30</span>    <span class="c1">#   del $const18.7</span>
<span class="linenos">31</span>    <span class="c1">#   del $16binary_subscr.6</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.5</span>
<span class="linenos">34</span>
<span class="linenos">35</span>    <span class="c1"># --- LINE 28 ---</span>
<span class="linenos">36</span>    <span class="c1">#   $28binary_subscr.11 = getitem(value=b, index=i, fn=&lt;built-in function getitem&gt;)  :: float32</span>
<span class="linenos">37</span>    <span class="c1">#   del b</span>
<span class="linenos">38</span>    <span class="c1">#   $const30.12 = const(float, 0.3)  :: float64</span>
<span class="linenos">39</span>    <span class="c1">#   l2 = $28binary_subscr.11 * $const30.12  :: float64</span>
<span class="linenos">40</span>    <span class="c1">#   del $const30.12</span>
<span class="linenos">41</span>    <span class="c1">#   del $28binary_subscr.11</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.3</span>
<span class="linenos">44</span>
<span class="linenos">45</span>    <span class="c1"># --- LINE 29 ---</span>
<span class="linenos">46</span>    <span class="c1">#   $40binary_add.16 = l1 + l2  :: float64</span>
<span class="linenos">47</span>    <span class="c1">#   del l2</span>
<span class="linenos">48</span>    <span class="c1">#   del l1</span>
<span class="linenos">49</span>    <span class="c1">#   c[i] = $40binary_add.16  :: (array(float32, 1d, C), int64, float64) -&gt; none</span>
<span class="linenos">50</span>    <span class="c1">#   del i</span>
<span class="linenos">51</span>    <span class="c1">#   del c</span>
<span class="linenos">52</span>    <span class="c1">#   del $40binary_add.16</span>
<span class="linenos">53</span>
<span class="linenos">54</span>    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
<span class="linenos">55</span>
<span class="linenos">56</span>    <span class="c1"># --- LINE 30 ---</span>
<span class="linenos">57</span>    <span class="c1">#   $48load_global.19 = global(revive: &lt;numba_dpex.compiler.DpexFunctionTemplate object at 0x7fce12e5cc40&gt;)  :: Function(&lt;numba_dpex.compiler.DpexFunctionTemplate object at 0x7fce12e5cc40&gt;)</span>
<span class="linenos">58</span>    <span class="c1">#   $52call_function.21 = call $48load_global.19(a, func=$48load_global.19, args=[Var(a, sum_local_vars_revive.py:26)], kws=(), vararg=None, target=None)  :: (array(float32, 1d, C),) -&gt; array(float32, 1d, C)</span>
<span class="hll"><span class="linenos">59</span>    <span class="c1">#   del a</span>
</span><span class="linenos">60</span>    <span class="c1">#   del $52call_function.21</span>
<span class="linenos">61</span>    <span class="c1">#   del $48load_global.19</span>
<span class="linenos">62</span>    <span class="c1">#   $const56.22 = const(NoneType, None)  :: none</span>
<span class="linenos">63</span>    <span class="c1">#   $58return_value.23 = cast(value=$const56.22)  :: none</span>
<span class="linenos">64</span>    <span class="c1">#   del $const56.22</span>
<span class="linenos">65</span>    <span class="c1">#   return $58return_value.23</span>
<span class="linenos">66</span>
<span class="linenos">67</span>    <span class="n">revive</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># pass variable to dummy function</span>
</pre></div>
</div>
<p>Run with environment variables <code class="samp docutils literal notranslate"><span class="pre">NUMBA_DUMP_ANNOTATION=1</span></code> and
<code class="samp docutils literal notranslate"><span class="pre">NUMBA_EXTEND_VARIABLE_LIFETIMES=1</span></code>.
It will show that numba inserts <cite>del</cite> for variables at the end of the block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="o">-----------------------------------</span><span class="n">ANNOTATION</span><span class="o">-----------------------------------</span>
<span class="linenos"> 2</span><span class="c1"># File: numba_dpex/examples/debug/sum_local_vars.py</span>
<span class="linenos"> 3</span><span class="o">...</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">data_parallel_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="linenos"> 5</span>    <span class="o">...</span>
<span class="linenos"> 6</span>    <span class="c1"># --- LINE 26 ---</span>
<span class="linenos"> 7</span>    <span class="c1">#   $40binary_add.16 = l1 + l2  :: float64</span>
<span class="linenos"> 8</span>    <span class="c1">#   c[i] = $40binary_add.16  :: (array(float32, 1d, C), int64, float64) -&gt; none</span>
<span class="linenos"> 9</span>    <span class="c1">#   $const48.19 = const(NoneType, None)  :: none</span>
<span class="linenos">10</span>    <span class="c1">#   $50return_value.20 = cast(value=$const48.19)  :: none</span>
<span class="hll"><span class="linenos">11</span>    <span class="c1">#   del $2load_global.0</span>
</span><span class="hll"><span class="linenos">12</span>    <span class="c1">#   del $const6.2</span>
</span><span class="hll"><span class="linenos">13</span>    <span class="c1">#   del $4load_method.1</span>
</span><span class="hll"><span class="linenos">14</span>    <span class="c1">#   del a</span>
</span><span class="hll"><span class="linenos">15</span>    <span class="c1">#   del $const18.7</span>
</span><span class="hll"><span class="linenos">16</span>    <span class="c1">#   del $16binary_subscr.6</span>
</span><span class="hll"><span class="linenos">17</span>    <span class="c1">#   del b</span>
</span><span class="hll"><span class="linenos">18</span>    <span class="c1">#   del $const30.12</span>
</span><span class="hll"><span class="linenos">19</span>    <span class="c1">#   del $28binary_subscr.11</span>
</span><span class="hll"><span class="linenos">20</span>    <span class="c1">#   del l2</span>
</span><span class="hll"><span class="linenos">21</span>    <span class="c1">#   del l1</span>
</span><span class="hll"><span class="linenos">22</span>    <span class="c1">#   del i</span>
</span><span class="hll"><span class="linenos">23</span>    <span class="c1">#   del c</span>
</span><span class="hll"><span class="linenos">24</span>    <span class="c1">#   del $40binary_add.16</span>
</span><span class="hll"><span class="linenos">25</span>    <span class="c1">#   del $const48.19</span>
</span><span class="linenos">26</span>    <span class="c1">#   return $50return_value.20</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
</pre></div>
</div>
</section>
<section id="example-3-using-info-locals">
<h3>Example 3 - Using <code class="docutils literal notranslate"><span class="pre">info</span> <span class="pre">locals</span></code><a class="headerlink" href="#example-3-using-info-locals" title="Link to this heading">#</a></h3>
<p>Source code <code class="file docutils literal notranslate"><span class="pre">sum_local_vars.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 5</span><span class="kn">import</span> <span class="nn">dpctl</span>
<span class="linenos"> 6</span><span class="kn">import</span> <span class="nn">dpnp</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="kn">import</span> <span class="nn">numba_dpex</span> <span class="k">as</span> <span class="nn">ndpx</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="nd">@ndpx</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">12</span><span class="k">def</span> <span class="nf">data_parallel_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="linenos">13</span>    <span class="n">i</span> <span class="o">=</span> <span class="n">ndpx</span><span class="o">.</span><span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">14</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.5</span>
<span class="linenos">15</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.3</span>
<span class="linenos">16</span>    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
<span class="linenos">17</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="n">global_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="linenos">20</span><span class="n">N</span> <span class="o">=</span> <span class="n">global_size</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="linenos">23</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="linenos">24</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="n">data_parallel_sum</span><span class="p">[</span><span class="n">ndpx</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">global_size</span><span class="p">)](</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the debugger with <code class="docutils literal notranslate"><span class="pre">NUMBA_OPT=0</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">NUMBA_OPT</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>gdb-oneapi<span class="w"> </span>-q<span class="w"> </span>python
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">set breakpoint pending on</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">break sum_local_vars.py:22</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">run sum_local_vars.py</span>
<span class="go">...</span>
<span class="go">Thread 2.2 hit Breakpoint 1, with SIMD lanes [0-7], __main__::data_parallel_sum () at sum_local_vars.py:22</span>
</pre></div>
</div>
<p>Run the <code class="docutils literal notranslate"><span class="pre">info</span> <span class="pre">locals</span></code> command. The sample output on “no optimization” level <code class="docutils literal notranslate"><span class="pre">NUMBA_OPT=0</span></code> is as follows:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">info locals</span>
</span><span class="hll"><span class="go">a = &#39;\000&#39; &lt;repeats 55 times&gt;</span>
</span><span class="hll"><span class="go">b = &#39;\000&#39; &lt;repeats 55 times&gt;</span>
</span><span class="hll"><span class="go">c = &#39;\000&#39; &lt;repeats 55 times&gt;</span>
</span><span class="hll"><span class="go">i = 0</span>
</span><span class="hll"><span class="go">l1 = 0</span>
</span><span class="hll"><span class="go">l2 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid0 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid1 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid2 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid0 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid1 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid2 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid0 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid1 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid2 = 0</span>
</span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">next</span>
<span class="go">Thread 2.3 hit Breakpoint 1, with SIMD lanes [0-1], __main__::data_parallel_sum () at sum_local_vars.py:22</span>
<span class="go">22          i = dpex.get_global_id(0)</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">next</span>
<span class="go">23          l1 = a[i] + 2.5</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">next</span>
<span class="go">24          l2 = b[i] * 0.3</span>
<span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">info locals</span>
</span><span class="hll"><span class="go">a = &#39;\000&#39; &lt;repeats 55 times&gt;</span>
</span><span class="hll"><span class="go">b = &#39;\000&#39; &lt;repeats 16 times&gt;, &quot;\n\000\000\000\000\000\000\000\004\000\000\000\000\000\000\000\000\240\016XUU\000\000\n\000\000\000\000\000\000\000\004\000\000\000\000\000\000&quot;</span>
</span><span class="hll"><span class="go">c = &#39;\000&#39; &lt;repeats 16 times&gt;, &quot;\n\000\000\000\000\000\000\000\004\000\000\000\000\000\000\000\000@\256WUU\000\000\n\000\000\000\000\000\000\000\004\000\000\000\000\000\000&quot;</span>
</span><span class="hll"><span class="go">i = 8</span>
</span><span class="hll"><span class="go">l1 = 2.5931931659579277</span>
</span><span class="hll"><span class="go">l2 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid0 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid1 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid2 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid0 = 42949672970</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid1 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid2 = 93825037590528</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid0 = 4612811918334230528</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid1 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid2 = 0</span>
</span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">next</span>
<span class="go">25          c[i] = l1 + l2</span>
</pre></div>
</div>
<p>Since the debugger does not hit a line with the target variable <code class="docutils literal notranslate"><span class="pre">l1</span></code>, the value equals 0. The true value of the variable <code class="docutils literal notranslate"><span class="pre">l1</span></code> is shown after stepping to line 22.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">info locals</span>
</span><span class="hll"><span class="go">a = &#39;\000&#39; &lt;repeats 55 times&gt;</span>
</span><span class="hll"><span class="go">b = &#39;\000&#39; &lt;repeats 55 times&gt;</span>
</span><span class="hll"><span class="go">c = &#39;\000&#39; &lt;repeats 16 times&gt;, &quot;\n\000\000\000\000\000\000\000\004\000\000\000\000\000\000\000\000@\256WUU\000\000\n\000\000\000\000\000\000\000\004\000\000\000\000\000\000&quot;</span>
</span><span class="hll"><span class="go">i = 8</span>
</span><span class="hll"><span class="go">l1 = 2.5931931659579277</span>
</span><span class="hll"><span class="go">l2 = 0.22954882979393004</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid0 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid1 = 8</span>
</span><span class="hll"><span class="go">__ocl_dbg_gid2 = 8</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid0 = 93825034429928</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid1 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_lid2 = 93825034429936</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid0 = 4599075939470750515</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid1 = 0</span>
</span><span class="hll"><span class="go">__ocl_dbg_grid2 = 0</span>
</span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">print a</span>
<span class="gp">$</span><span class="nv">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;\000&#39;</span><span class="w"> </span>&lt;repeats<span class="w"> </span><span class="m">55</span><span class="w"> </span>times&gt;
</pre></div>
</div>
<p>When the debugger hits the last line of the kernel, <code class="docutils literal notranslate"><span class="pre">info</span> <span class="pre">locals</span></code> command returns all the local variables with their values.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="numba-0.55.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Debugging Features in Numba 0.55</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="altering.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Altering Execution</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2020-2024, Intel Corporation
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/IntelPython/numba-dpex" aria-label="GitHub"></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Debugging Local Variables</a><ul>
<li><a class="reference internal" href="#optimization-level-for-llvm">Optimization Level for LLVM</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#local-variables-lifetime-in-numba-ir">Local Variables Lifetime in Numba IR</a><ul>
<li><a class="reference internal" href="#example-1-using-numba-extend-variable-lifetimes">Example 1 - Using <code class="docutils literal notranslate"><span class="pre">NUMBA_EXTEND_VARIABLE_LIFETIMES</span></code></a></li>
<li><a class="reference internal" href="#example-2-using-numba-dump-annotation">Example 2 - Using <code class="docutils literal notranslate"><span class="pre">NUMBA_DUMP_ANNOTATION</span></code></a></li>
<li><a class="reference internal" href="#example-3-using-info-locals">Example 3 - Using <code class="docutils literal notranslate"><span class="pre">info</span> <span class="pre">locals</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>