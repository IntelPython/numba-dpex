<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>numba_dpex.core.passes.lowerer module &mdash; numba-dpex 0.20.0dev3+13.g1b948c24 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            numba-dpex
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CoreFeatures.html">Code-generation based on a device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CoreFeatures.html#automatic-offload-of-numpy-expressions">Automatic offload of NumPy expressions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guides/getting_started.html"> Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guides/kernel_programming_guide/index.html"> Direct kernel programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guides/debugging/index.html"> Debugging with GDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guides/migrating_from_numba_cuda.html"> numba-dpex for numba.cuda Programmers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_guides/dpnp_integration.html">dpnp integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guides/tools.html">Debugging the compilation pipeline</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">numba-dpex</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">numba_dpex.core.passes.lowerer module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/apidoc/numba_dpex.core.passes.lowerer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-numba_dpex.core.passes.lowerer">
<span id="numba-dpex-core-passes-lowerer-module"></span><h1>numba_dpex.core.passes.lowerer module<a class="headerlink" href="#module-numba_dpex.core.passes.lowerer" title="Permalink to this heading"></a></h1>
<dl class="py exception">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.CopyIRException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">CopyIRException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.CopyIRException" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">RuntimeError</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.DPEXLowerer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">DPEXLowerer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">library</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fndesc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func_ir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.DPEXLowerer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Lower</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.DPEXLowerer.create_cpython_wrapper">
<span class="sig-name descname"><span class="pre">create_cpython_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">release_gil</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.DPEXLowerer.create_cpython_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>Create CPython wrapper(s) around this function (or generator).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.DPEXLowerer.lower">
<span class="sig-name descname"><span class="pre">lower</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.DPEXLowerer.lower" title="Permalink to this definition"></a></dt>
<dd><p>Custom lowering function to support offloading of kernels.</p>
<p>The lowerer has a builtin fallback mechanism for parfor functions. We
first try to lower a parfor onto a SYCL device, if the lowering fails
then we fallback to the default Numba lowering to CPU. The lowering
follow the following steps:</p>
<ol class="arabic">
<li><p>Start lowering of parent function</p></li>
<li><dl>
<dt>Try to lower parfor onto the specified SYCL device</dt><dd><dl>
<dt>2.a. The <code class="docutils literal notranslate"><span class="pre">lower_parfor_rollback</span></code> function prepares function to</dt><dd><p>lower onto to the specified SYCL device and inserts the
<code class="docutils literal notranslate"><span class="pre">get_global_id</span></code> intrinsic function.</p>
<p>2.a.a. Start lowering the parfor body and execute
<code class="docutils literal notranslate"><span class="pre">DpexLowerer.lower()</span></code> again.
2.a.b. If the lowering fails, throw an exception.</p>
</dd>
<dt>2.b. The <code class="docutils literal notranslate"><span class="pre">lower_parfor_rollback</span></code> catches the exception and</dt><dd><p>restores the parfor body to its initial state.</p>
</dd>
<dt>2.c. Then throw an exception inside <code class="docutils literal notranslate"><span class="pre">lower_parfor_rollback</span></code></dt><dd><p>that will be caught inside <code class="docutils literal notranslate"><span class="pre">DpexLowerer.lower()</span></code>.</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><p>Catch exception and start parfor lowering with the default Numba CPU
context.</p></li>
</ol>
<p>TODO/FIXME The rollback approach only works in case no device specific
modifications were added to function containing the parfor node. If the
function has any device specific modifications, a different solution
should be used.</p>
<dl class="simple">
<dt>Raises:</dt><dd><p>Exception: If a parfor node could not be lowered to a SYCL device.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.WrapperDefaultLower">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">WrapperDefaultLower</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">library</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fndesc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func_ir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.WrapperDefaultLower" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Lower</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.copy_block">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">copy_block</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.copy_block" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.find_setitems_block">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">find_setitems_block</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">setitems</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typemap</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.find_setitems_block" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.find_setitems_body">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">find_setitems_body</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">setitems</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop_body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typemap</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.find_setitems_body" title="Permalink to this definition"></a></dt>
<dd><p>Find the arrays that are written into (goes into setitems)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.generate_kernel_launch_ops">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">generate_kernel_launch_ops</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lowerer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gu_signature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outer_sig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expr_args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expr_arg_types</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop_ranges</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">modified_arrays</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.generate_kernel_launch_ops" title="Permalink to this definition"></a></dt>
<dd><p>Adds the call to the gufunc function from the main function.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.legalize_names_with_typemap">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">legalize_names_with_typemap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typemap</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.legalize_names_with_typemap" title="Permalink to this definition"></a></dt>
<dd><p>We use ir_utils.legalize_names to replace internal IR variable names
containing illegal characters (e.g. period) with a legal character
(underscore) so as to create legal variable names.
The original variable names are in the typemap so we also
need to add the legalized name to the typemap as well.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.lower_parfor_rollback">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">lower_parfor_rollback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lowerer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parfor</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.lower_parfor_rollback" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.relatively_deep_copy">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">relatively_deep_copy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memo</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.relatively_deep_copy" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.replace_var_with_array">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">replace_var_with_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop_body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typemap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calltypes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.replace_var_with_array" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.replace_var_with_array_in_block">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">replace_var_with_array_in_block</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typemap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calltypes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.replace_var_with_array_in_block" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.replace_var_with_array_internal">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">replace_var_with_array_internal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop_body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typemap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calltypes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.replace_var_with_array_internal" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.to_scalar_from_0d">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">to_scalar_from_0d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.to_scalar_from_0d" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.unwrap_loop_body">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">unwrap_loop_body</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loop_body</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.unwrap_loop_body" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="numba_dpex.core.passes.lowerer.wrap_loop_body">
<span class="sig-prename descclassname"><span class="pre">numba_dpex.core.passes.lowerer.</span></span><span class="sig-name descname"><span class="pre">wrap_loop_body</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loop_body</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#numba_dpex.core.passes.lowerer.wrap_loop_body" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021,2022 Intel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>