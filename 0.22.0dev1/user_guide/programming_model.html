
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LGGL0NJK6P"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-LGGL0NJK6P');
    </script>
    
    <title>Programming Model &#8212; numba-dpex  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/programming_model';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kernel Programming Basics" href="kernel_programming/index.html" />
    <link rel="prev" title="User Guide" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">numba-dpex  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api_reference/index.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contribution_guide.html">
                        Contribution Guide
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../examples.html">
                        List of examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../glossary.html">
                        Glossary
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../release-notes.html">
                        Release Notes
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/IntelPython/numba-dpex" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://app.gitter.im/#/room/#Data-Parallel-Python_community:gitter.im" title="Gitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-brands fa-gitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Gitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api_reference/index.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contribution_guide.html">
                        Contribution Guide
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links-2">
                    More
                </button>
                <ul id="pst-nav-more-links-2" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../examples.html">
                        List of examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../glossary.html">
                        Glossary
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../release-notes.html">
                        Release Notes
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/IntelPython/numba-dpex" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://app.gitter.im/#/room/#Data-Parallel-Python_community:gitter.im" title="Gitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-brands fa-gitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Gitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Programming Model</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="kernel_programming/index.html">Kernel Programming Basics</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="kernel_programming/writing_kernels.html">Writing Data Parallel Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_programming/synchronization.html">Synchronization Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_programming/device-functions.html">Writing Device Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_programming/atomic-operations.html">Supported Atomic Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_programming/memory_allocation_address_space.html">Supported Address Space Qualifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_programming/reduction.html">Reduction on SYCL-supported Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_programming/ufunc.html">Universal Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_programming/supported-python-features.html">Supported Python Features inside <code class="docutils literal notranslate"><span class="pre">numba_dpex.kernel</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dpnp_offload.html">Compiling and Offloading <code class="docutils literal notranslate"><span class="pre">dpnp</span></code> statements</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="debugging/index.html">Debugging with Intel® Distribution for GDB*</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="debugging/set_up_machine.html">Set up the machine for debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging/debugging_environment.html">Configure debugging environment</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="debugging/features.html">Supported Features</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="debugging/breakpoints.html">Breakpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/stepping.html">Stepping</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/frame_info.html">Information About a Frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/backtrace.html">Backtrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/data.html">Examining Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/symbols.html">Examining the Symbol Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/altering.html">Altering Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/local_variables.html">Debugging Local Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/numba-0.55.html">Debugging Features in Numba 0.55</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="debugging/limitations.html">Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging/common_issues.html">Common issues and tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">Caching Mechanism in <code class="docutils literal notranslate"><span class="pre">numba-dpex</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration Options for <code class="docutils literal notranslate"><span class="pre">numba-dpex</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="useful_links.html">Useful links</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Programming Model</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <span class="target" id="programming-model"></span><section id="id2">
<h1>Programming Model<a class="headerlink" href="#id2" title="Link to this heading">#</a></h1>
<p>In a heterogeneous system there may be <strong>multiple</strong> devices a Python user may
want to engage. For example, it is common for a consumer-grade laptop to feature
an integrated or a discrete GPU alongside a CPU.</p>
<p>To harness their power one needs to know how to answer the following 3 key
questions:</p>
<ol class="arabic simple">
<li><p>How does a Python program recognize available computational devices?</p></li>
<li><p>How does a Python workload specify computations to be offloaded to selected
devices?</p></li>
<li><p>How does a Python application manage data sharing?</p></li>
</ol>
<section id="recognizing-available-devices">
<h2>Recognizing available devices<a class="headerlink" href="#recognizing-available-devices" title="Link to this heading">#</a></h2>
<p>Python package <code class="docutils literal notranslate"><span class="pre">dpctl</span></code> answers these questions. All the computational devices
known to the underlying DPC++ runtime can be accessed using
<code class="docutils literal notranslate"><span class="pre">dpctl.get_devices()</span></code>. A specific device of interest <a class="reference external" href="https://intelpython.github.io/dpctl/latest/docfiles/user_guides/manual/dpctl/device_selection.html">can be selected</a>
either using a helper function, e.g. <code class="docutils literal notranslate"><span class="pre">dpctl.select_gpu_device()</span></code>, or by
passing a filter selector string to <code class="docutils literal notranslate"><span class="pre">dpctl.SyclDevice</span></code> constructor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dpctl</span>

<span class="c1"># select a GPU device. If multiple devices present,</span>
<span class="c1"># let the underlying runtime select from GPUs</span>
<span class="n">dev_gpu</span> <span class="o">=</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">SyclDevice</span><span class="p">(</span><span class="s2">&quot;gpu&quot;</span><span class="p">)</span>
<span class="c1"># select a CPU device</span>
<span class="n">dev_cpu</span> <span class="o">=</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">SyclDevice</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

<span class="c1"># stand-alone function, equivalent to C++</span>
<span class="c1">#   `auto dev = sycl::gpu_selector().select_device();`</span>
<span class="n">dev_gpu_alt</span> <span class="o">=</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">select_gpu_device</span><span class="p">()</span>
<span class="c1"># stand-alone function, equivalent to C++</span>
<span class="c1">#   `auto dev = sycl::cpu_selector().select_device();`</span>
<span class="n">dev_cpu_alt</span> <span class="o">=</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">select_cpu_device</span><span class="p">()</span>
</pre></div>
</div>
<p>A <a class="reference external" href="https://intelpython.github.io/dpctl/latest/docfiles/user_guides/manual/dpctl/devices.html">device object</a>
can be used to query properies of the device, such as its name, vendor, maximal
number of computational units, memory size, etc.</p>
</section>
<section id="specifying-offload-target">
<h2>Specifying offload target<a class="headerlink" href="#specifying-offload-target" title="Link to this heading">#</a></h2>
<p>To answer the second question on the list we need a digression to explain
offloading in oneAPI DPC++ first.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In DPC++, a computation kernel can be specified using generic C++
programming and then the kernel can be offloaded to any device that is
supported by an underlying SYCL runtime. The device to which the kernel
is offloaded is specified using an <strong>execution queue</strong> when <em>launching
the kernel</em>.</p>
<p>The oneAPI unified programming model brings portability across heterogeneous
architectures. Another important aspect of the programming model is its
inherent flexibility that makes it possible to go beyond portability and even
strive for performance portability. An oneAPI library may be implemented
using C++ techniques such as template metaprogramming or dynamic polymorphism
to implement specializations for a generic kernel. If a kernel is implemented
polymorphically, the specialized implementation will be dispatched based on
the execution queue specified during kernel launch. The oneMKL library is an
example of a performance portable oneAPI library.</p>
</div>
<p>A computational task is offloaded for execution on a device by submitting it to
DPC++ runtime which inserts the task in a computational graph. Once the device
becomes available the runtime selects a task whose dependencies are met for
execution. The computational graph as well as the device targeted by its tasks
are stored in a <a class="reference external" href="https://intelpython.github.io/dpctl/latest/docfiles/user_guides/manual/dpctl/queues.html">SYCL queue</a>
object. The task submission is therefore always associated with a queue.</p>
<p>Queues can be constructed directly from a device object, or by using a filter
selector string to indicate the device to construct:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># construct queue from device object</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">SyclQueue</span><span class="p">(</span><span class="n">dev_gpu</span><span class="p">)</span>
<span class="c1"># construct queue using filter selector</span>
<span class="n">q2</span> <span class="o">=</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">SyclQueue</span><span class="p">(</span><span class="s2">&quot;gpu&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The computational tasks can be stored in an oneAPI native extension in which
case their submission is orchestrated during Python API calls. Let’s consider a
function that offloads an evaluation of a polynomial for every point of a NumPy
array <code class="docutils literal notranslate"><span class="pre">X</span></code>. Such a function needs to receive a queue object to indicate which
device the computation must be offloaded to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># allocate space for the result</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="c1"># evaluate polynomial on the device targeted by the queue, Y[i] = p(X[i])</span>
<span class="n">onapi_ext</span><span class="o">.</span><span class="n">offloaded_poly_evaluate</span><span class="p">(</span><span class="n">exec_q</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>Python call to <code class="docutils literal notranslate"><span class="pre">onapi_ext.offloaded_poly_evaluate</span></code> applied to NumPy arrays of
double precision floating pointer numbers gets translated to the following
sample C++ code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">cpp_offloaded_poly_evaluate</span><span class="p">(</span>
<span class="w">  </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// create buffers from malloc allocations to make data accessible from device</span>
<span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buf_X</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buf_Y</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>

<span class="w">    </span><span class="n">q</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">sycl</span><span class="o">::</span><span class="n">handler</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cgh</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// create buffer accessors indicating kernel data-flow pattern</span>
<span class="w">        </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">acc_X</span><span class="p">(</span><span class="n">buf_X</span><span class="p">,</span><span class="w"> </span><span class="n">cgh</span><span class="p">,</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">read_only</span><span class="p">);</span>
<span class="w">        </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">acc_Y</span><span class="p">(</span><span class="n">buf_Y</span><span class="p">,</span><span class="w"> </span><span class="n">cgh</span><span class="p">,</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">write_only</span><span class="p">,</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">no_init</span><span class="p">);</span>

<span class="w">        </span><span class="n">cgh</span><span class="p">.</span><span class="n">parallel_for</span><span class="p">(</span><span class="n">n</span><span class="p">,</span>
<span class="w">           </span><span class="c1">// lambda function that gets executed by different work-items with</span>
<span class="w">           </span><span class="c1">// different arguments in parallel</span>
<span class="w">           </span><span class="p">[</span><span class="o">=</span><span class="p">](</span><span class="n">sycl</span><span class="o">::</span><span class="n">id</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accX</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>
<span class="w">              </span><span class="n">accY</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">-0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">));</span>
<span class="w">           </span><span class="p">});</span>
<span class="w">    </span><span class="p">}).</span><span class="n">wait</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We refer an interested reader to an excellent and freely available “<a class="reference external" href="https://link.springer.com/book/10.1007%2F978-1-4842-5574-2">Data
Parallel C++</a>”
book for details of this data parallel C++.</p>
<p>Our package <code class="docutils literal notranslate"><span class="pre">numba_dpex</span></code> allows one to write kernels directly in Python.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numba_dpex</span>


<span class="nd">@numba_dpex</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span> <span class="nf">numba_dpex_poly</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">numba_dpex</span><span class="o">.</span><span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>Specifying the execution queue is done using Python context manager:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="k">with</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">device_context</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="c1"># apply the kernel to elements of X, writing value into Y,</span>
    <span class="c1"># while executing using given queue</span>
    <span class="n">numba_dpex_poly</span><span class="p">[</span><span class="n">numba_dpex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">size</span><span class="p">)](</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>The argument to <code class="docutils literal notranslate"><span class="pre">device_context</span></code> can be a queue object, a device object for
which a temporary queue will be created, or a filter selector string. Thus we
could have equally used <code class="docutils literal notranslate"><span class="pre">dpctl.device_context(gpu_dev)</span></code> or
<code class="docutils literal notranslate"><span class="pre">dpctl.device_context(&quot;gpu&quot;)</span></code>.</p>
<p>Note that in this examples data sharing was implicitly managed for us: in the
case of calling a function from a precompiled oneAPI native extension data
sharing was managed by DPC++ runtime, while in the case of using <code class="docutils literal notranslate"><span class="pre">numba_dpex</span></code>
kernel it was managed during execution of <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method.</p>
</section>
<section id="data-sharing">
<h2>Data sharing<a class="headerlink" href="#data-sharing" title="Link to this heading">#</a></h2>
<p>Implicit management of data is surely convenient, but its use in an interpreted
code comes at a performance cost. A runtime must implicitly copy data from host
to the device before the kernel execution commences and then copy some (or all)
of it back after the execution completes for every Python API call.</p>
<p><code class="docutils literal notranslate"><span class="pre">dpctl</span></code> provides for allocating memory directly accessible to kernels
executing on a device using SYCL’s Unified Shared Memory (<a class="reference external" href="https://www.khronos.org/registry/SYCL/specs/sycl-2020/html/sycl-2020.html#sec:usm">USM</a>)
feature. It also implements USM-based ND-array object
<code class="docutils literal notranslate"><span class="pre">dpctl.tensor.usm_ndarray</span></code> that conforms <a class="reference external" href="https://data-apis.org/array-api/latest/">array-API standard</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dpctl.tensor</span> <span class="k">as</span> <span class="nn">dpt</span>

<span class="c1"># allocate array of doubles using USM-device allocation on GPU device</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">dpt</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;gpu&quot;</span><span class="p">,</span> <span class="n">usm_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>
<span class="c1"># allocate array for the output</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">dpt</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># execution queue is inferred from allocation queues.</span>
<span class="c1"># Kernel is executed on the same device where arrays were allocated</span>
<span class="n">numba_dpex_poly</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">numba_dpex</span><span class="o">.</span><span class="n">DEFAULT_LOCAL_SIZE</span><span class="p">](</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>The execution queue can be unambiguously determined in this case since both
arguments are USM arrays with the same allocation queues and <code class="docutils literal notranslate"><span class="pre">X.sycl_queue</span> <span class="pre">==</span>
<span class="pre">Y.sycl_queue</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>. Should allocation queues be different,
such an inference becomes ambiguous and <code class="docutils literal notranslate"><span class="pre">numba_dpex</span></code> raises
<code class="docutils literal notranslate"><span class="pre">IndeterminateExecutionQueueError</span></code> advising user to explicitly migrate the
data.</p>
<p>Migration can be accomplished either by using <code class="docutils literal notranslate"><span class="pre">dpctl.tensor.asarray(X,</span>
<span class="pre">device=target_device)</span></code> to create a copy, or by using
<code class="docutils literal notranslate"><span class="pre">X.to_device(target_device)</span></code> method.</p>
<p>A USM array can be copied back into a NumPy array using <code class="docutils literal notranslate"><span class="pre">dpt.asnumpy(Y)</span></code> if
needed.</p>
</section>
<section id="compute-follows-data">
<h2>Compute follows data<a class="headerlink" href="#compute-follows-data" title="Link to this heading">#</a></h2>
<p>Automatic deduction of the execution queue from allocation queues is consitent
with “<a class="reference external" href="https://data-apis.org/array-api/latest/design_topics/device_support.html">local control for data allocation target</a>”
in the array API standard. User has full control over memory allocation through
three keyword arguments present in all <a class="reference external" href="https://data-apis.org/array-api/latest/API_specification/creation_functions.html">array creation functions</a>.
For example, consider</p>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">device</span></code> is <a class="reference external" href="https://data-apis.org/array-api/latest/design_topics/device_support.html#syntax-for-device-assignment">mandated by the array API</a>.
In <code class="docutils literal notranslate"><span class="pre">dpctl.tensor</span></code> the allowed values of the keyword are</p>
<ul class="simple">
<li><p>Filter selector string, e.g. <code class="docutils literal notranslate"><span class="pre">device=&quot;gpu:0&quot;</span></code></p></li>
<li><p>Existing <code class="docutils literal notranslate"><span class="pre">dpctl.SyclDevice</span></code> object, e.g. <code class="docutils literal notranslate"><span class="pre">device=dev_gpu</span></code></p></li>
<li><p>Existing <code class="docutils literal notranslate"><span class="pre">dpctl.SyclQueue</span></code> object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dpctl.tensor.Device</span></code> object instance obtained from an existing USM array,
e.g. <code class="docutils literal notranslate"><span class="pre">device=X.device</span></code></p></li>
</ul>
<p>In all cases, an allocation queue object will be constructed as described
<a class="reference external" href="#specifying-offload-target">earlier</a> and stored in the array instance,
accessible with <code class="docutils literal notranslate"><span class="pre">X.sycl_queue</span></code>. Instead of using <code class="docutils literal notranslate"><span class="pre">device</span></code> keyword, one can
alternatively use <code class="docutils literal notranslate"><span class="pre">sycl_queue</span></code> keyword for readability to directly specify a
<code class="docutils literal notranslate"><span class="pre">dpctl.SyclQueue</span></code> object to be used as the allocation queue.</p>
<p>The rationale for storing the allocation queue in the array is that kernels
submitted to this queue are guaranteed to be able to correctly dereference (i.e.
access) the USM pointer. Array operations that only involve this single USM
array can thus execute on the allocation queue, and the output array can be
allocated on this same allocation queue with the same usm type as the input
array.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reusing the allocation queue of the input
array ensures the computational tasks behind the API call can access the
array without making implicit copies and the output array is allocated
on the same device as the input.</p>
</div>
<p>Compute follows data is the rule prescribing deduction of the execution and the
allocation queue as well as the USM type for the result when multiple USM arrays
are combined. It stipulates that arrays can be combined if and only if their
allocation <em>queues are the same</em> as measured by <code class="docutils literal notranslate"><span class="pre">==</span></code> operator (i.e.
<code class="docutils literal notranslate"><span class="pre">X.sycl_queue</span> <span class="pre">==</span> <span class="pre">Y.sycl_queue</span></code> must evaluate to <code class="docutils literal notranslate"><span class="pre">True</span></code>). Same queues refer
to the same underlying task graphs and DPC++ schedulers.</p>
<p>An attempt to combine USM arrays with unsame allocation queues raises an
exception advising the user to migrate the data. Migration can be accomplished
either by using <code class="docutils literal notranslate"><span class="pre">dpctl.tensor.asarray(X,</span> <span class="pre">device=Y.device)</span></code> to create a copy,
or by using <code class="docutils literal notranslate"><span class="pre">X.to_device(Y.device)</span></code> method which can sometime do the migration
more efficiently.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">dpctl</span></code> and <code class="docutils literal notranslate"><span class="pre">numba_dpex</span></code> are both under heavy development. Feel free to file an
issue on GitHub or reach out on Gitter should you encounter any issues.</p>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">User Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="kernel_programming/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Kernel Programming Basics</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recognizing-available-devices">Recognizing available devices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-offload-target">Specifying offload target</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-sharing">Data sharing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-follows-data">Compute follows data</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2020-2023, Intel Corporation.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>